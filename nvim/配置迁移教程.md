# Neovim 配置迁移教程（macOS 新机）

## 📋 目录
- [前置要求](#前置要求)
- [快速迁移步骤](#快速迁移步骤)
- [详细安装说明](#详细安装说明)
- [验证安装](#验证安装)
- [常见问题](#常见问题)

---

## 🔧 前置要求

### 1. 安装 Neovim（0.9.0+）

```bash
# 使用 Homebrew 安装最新版本
brew install neovim

# 验证安装
nvim --version
```

### 2. 安装必需的命令行工具

```bash
# 安装 ripgrep（文件内容搜索）
brew install ripgrep

# 安装 fd（快速文件查找）
brew install fd

# 安装 git（版本控制）
brew install git

# 安装 Node.js（某些 LSP 服务器需要）
brew install node

# 安装 Python3（某些插件需要）
brew install python3
```

### 3. 安装字体（可选但推荐）

为了正确显示图标，建议安装 Nerd Font：

```bash
# 安装 Nerd Font
brew tap homebrew/cask-fonts
brew install --cask font-jetbrains-mono-nerd-font
# 或者安装其他 Nerd Font，例如：
# brew install --cask font-hack-nerd-font
# brew install --cask font-fira-code-nerd-font
```

**配置终端字体：**
- iTerm2: `Preferences → Profiles → Text → Font` 选择 Nerd Font
- Terminal.app: `偏好设置 → 描述文件 → 字体` 选择 Nerd Font

---

## 🚀 快速迁移步骤

### 方案 A：从本配置仓库迁移

如果你已经有这个配置仓库：

```bash
# 1. 备份旧配置（如果有）
mv ~/.config/nvim ~/.config/nvim.backup
mv ~/.local/share/nvim ~/.local/share/nvim.backup

# 2. 复制配置文件
cp -r /Users/konnor/dev/development-note/nvim ~/.config/nvim

# 3. 启动 Neovim，插件会自动安装
nvim
```

### 方案 B：从旧机器迁移

在**旧机器**上：

```bash
# 打包配置文件
cd ~/.config
tar -czf nvim-config.tar.gz nvim/

# 将文件传输到新机器（通过云盘、U盘或网络）
```

在**新机器**上：

```bash
# 解压配置
cd ~/.config
tar -xzf nvim-config.tar.gz

# 启动 Neovim
nvim
```

---

## 📦 详细安装说明

### 第一次启动

1. **启动 Neovim**
   ```bash
   nvim
   ```

2. **等待插件自动安装**
   - Lazy.nvim 会自动下载并安装所有插件
   - 这个过程需要几分钟，取决于网络速度
   - 可以看到安装进度的浮动窗口

3. **安装 LSP 服务器**（首次启动后）
   ```vim
   :Mason
   ```
   
   在 Mason 界面中，按 `i` 安装以下常用 LSP 服务器：
   - `lua_ls` - Lua
   - `pyright` - Python
   - `tsserver` - TypeScript/JavaScript
   - `rust_analyzer` - Rust
   - `gopls` - Go
   - 根据你的开发语言选择相应的服务器

4. **退出并重启 Neovim**
   ```vim
   :qa
   ```
   然后再次启动 `nvim`

---

## ✅ 验证安装

### 1. 检查 Neovim 健康状态

```vim
:checkhealth
```

查看是否有错误或警告，特别关注：
- `provider` - Python、Node.js 等提供者
- `telescope` - 搜索工具依赖
- `treesitter` - 语法高亮

### 2. 测试基本功能

创建一个测试文件：

```bash
nvim test.lua
```

按 `i` 进入插入模式，输入：
```lua
local function hello()
  print("Hello, Neovim!")
end
```

测试功能：
- 语法高亮是否正常
- 按 `jk` 是否能退出插入模式
- 按 `<Space>e` 是否打开文件树
- 按 `<Space>f` 是否打开文件搜索

### 3. 检查插件状态

```vim
:Lazy
```

确保所有插件都已成功安装（绿色勾号）。

---

## 🔍 常见问题

### Q1: 插件安装失败

**解决方案：**
```bash
# 清除缓存并重新安装
rm -rf ~/.local/share/nvim
rm -rf ~/.cache/nvim
nvim
```

### Q2: 图标显示为乱码或方块

**原因：** 终端字体不是 Nerd Font

**解决方案：**
1. 安装 Nerd Font（见前置要求）
2. 在终端设置中更改字体为 Nerd Font
3. 重启终端和 Neovim

### Q3: Telescope 搜索报错

**确认依赖安装：**
```bash
# 确认 ripgrep 已安装
rg --version

# 确认 fd 已安装
fd --version
```

### Q4: LSP 不工作

**解决方案：**
```vim
:Mason
```
按 `i` 安装对应语言的 LSP 服务器，然后重启 Neovim。

### Q5: Python 提供者警告

**解决方案：**
```bash
# 安装 pynvim
pip3 install --user pynvim
```

### Q6: Treesitter 解析器安装失败

**解决方案：**
```bash
# 安装 C 编译器（如果没有）
xcode-select --install

# 在 Neovim 中重新安装解析器
:TSInstall lua python javascript typescript
```

### Q7: 网络问题导致插件下载慢

**使用镜像（可选）：**

编辑 `~/.config/nvim/lua/configs/lazy.lua`，在 lazy 配置中添加：

```lua
require("lazy").setup({
  spec = {
    { import = "plugins" },
  },
  git = {
    url_format = "https://mirror.ghproxy.com/https://github.com/%s.git",
  },
})
```

---

## 📂 配置文件说明

迁移后的配置文件结构：

```
~/.config/nvim/
├── init.lua                 # 主入口文件
├── lazy-lock.json          # 插件版本锁定文件
├── lua/
│   ├── configs/            # 基础配置
│   │   ├── basic.lua       # 基本设置
│   │   ├── mappings.lua    # 快捷键配置
│   │   ├── lazy.lua        # 插件管理器
│   │   └── ...
│   ├── plugins/            # 插件配置（每个插件一个文件）
│   │   ├── init.lua        # 主题配置
│   │   ├── telescope.lua   # 文件搜索
│   │   ├── nvim-tree.lua   # 文件树
│   │   └── ...
│   └── lsp/                # LSP 配置
│       ├── init.lua
│       └── lsp.lua
└── README.md               # 配置说明
```

---

## 🎯 下一步

安装完成后，查看：
- [使用指南与快捷键.md](./使用指南与快捷键.md) - 学习如何使用这个配置
- [插件功能详解.md](./插件功能详解.md) - 了解每个插件的功能

---

## 📝 备注

- 首次启动可能需要 5-10 分钟安装所有内容
- 建议在稳定的网络环境下进行初始化
- 如遇到问题，可以查看 `:checkhealth` 的输出
- 保留旧配置的备份，以防需要回滚

---

**迁移完成后，享受你的 Neovim！** 🎉
